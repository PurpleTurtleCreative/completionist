!function(t){var e={};function n(o){if(e[o])return e[o].exports;var a=e[o]={i:o,l:!1,exports:{}};return t[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(o,a,function(e){return t[e]}.bind(null,a));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=16)}([function(t,e){!function(){t.exports=this.wp.element}()},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}t.exports=function(t,e,o){return e&&n(t.prototype,e),o&&n(t,o),t}},function(t,e,n){var o=n(10);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}},function(t,e){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},n(e)}t.exports=n},function(t,e,n){var o=n(11),a=n(1);t.exports=function(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?a(t):e}},function(t,e,n){var o=n(12),a=n(13),i=n(14),r=n(15);t.exports=function(t){return o(t)||a(t)||i(t)||r()}},function(t,e){t.exports=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}},function(t,e){function n(e,o){return t.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(e,o)}t.exports=n},function(t,e){function n(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=n=function(t){return typeof t}:t.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(e)}t.exports=n},function(t,e,n){var o=n(9);t.exports=function(t){if(Array.isArray(t))return o(t)}},function(t,e){t.exports=function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}},function(t,e,n){var o=n(9);t.exports=function(t,e){if(t){if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,e,n){"use strict";n.r(e);var o=n(2),a=n.n(o),i=n(3),r=n.n(i),c=n(1),s=n.n(c),u=n(4),l=n.n(u),p=n(6),m=n.n(p),d=n(5),f=n.n(d),h=n(0);function b(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=f()(t);if(e){var a=f()(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return m()(this,n)}}var v=function(t){l()(n,t);var e=b(n);function n(t){var o;return a()(this,n),(o=e.call(this,t)).state=t.automation,o.goToAutomation=t.goToAutomation,o}return r()(n,[{key:"render",value:function(){var t=this;return Object(h.createElement)("div",{className:"ptc-completionist-automation-row"},Object(h.createElement)("h2",null,"(Title) Automation ",this.state.ID),Object(h.createElement)("ul",null,Object(h.createElement)("li",null,"Last Modified: ",this.state.last_modified),Object(h.createElement)("li",null,"Total Actions: ",Object(h.createElement)("em",null,"Unknown")),Object(h.createElement)("li",null,"Last Action Trigger: ",Object(h.createElement)("em",null,"Unknown")),Object(h.createElement)("li",null,"Total Action Triggers: ",Object(h.createElement)("em",null,"Unknown"))),Object(h.createElement)("button",{onClick:function(){return t.goToAutomation(t.state.ID)}},"Edit"),Object(h.createElement)("button",{onClick:function(){return console.log("Delete "+t.state.ID)}},"Delete"))}}]),n}(wp.element.Component);function y(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=f()(t);if(e){var a=f()(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return m()(this,n)}}var g=function(t){l()(n,t);var e=y(n);function n(t){var o;return a()(this,n),(o=e.call(this,t)).state={automations:t.automations,orderBy:"title"},o.goToAutomation=t.goToAutomation,o}return r()(n,[{key:"render",value:function(){var t=this,e=this.state.automations.map((function(e){return Object(h.createElement)(v,{automation:e,goToAutomation:t.goToAutomation,key:e.ID})}));return Object(h.createElement)("div",{className:"ptc-completionist-automations-listing"},Object(h.createElement)("h1",null,"Automations Listing"),Object(h.createElement)("button",{onClick:function(){return t.goToAutomation("new")}},"Add New"),Object(h.createElement)("div",{className:"ptc-completionist-automations-list"},e))}}]),n}(wp.element.Component),O=n(7),j=n.n(O),_=n(8),E=n.n(_);function k(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function A(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?k(Object(n),!0).forEach((function(e){E()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function C(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=f()(t);if(e){var a=f()(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return m()(this,n)}}var w=wp.element.Component,S=function(t){l()(n,t);var e=C(n);function n(t){var o;return a()(this,n),o=e.call(this,t),"automation"in t?(o.state=t.automation,o.state.saveButtonLabel="Create","ID"in t.automation&&t.automation.ID>0&&(o.state.saveButtonLabel="Update")):o.state={ID:0,title:"",description:"",hook_name:"",last_modified:"",conditions:[],actions:[],saveButtonLabel:"Create"},o.handleAutomationChange=o.handleAutomationChange.bind(s()(o)),o.handleConditionChange=o.handleConditionChange.bind(s()(o)),o.handleAddCondition=o.handleAddCondition.bind(s()(o)),o.handleRemoveCondition=o.handleRemoveCondition.bind(s()(o)),o.handleActionChange=o.handleActionChange.bind(s()(o)),o.handleActionMetaChange=o.handleActionMetaChange.bind(s()(o)),o.handleAddAction=o.handleAddAction.bind(s()(o)),o.handleRemoveAction=o.handleRemoveAction.bind(s()(o)),o}return r()(n,[{key:"handleAutomationChange",value:function(t,e){this.setState((function(n){return E()({},t,e)}))}},{key:"handleConditionChange",value:function(t,e,n){this.setState((function(o){var a=j()(o.conditions);return a[t]=A(A({},o.conditions[t]),{},E()({},e,n)),{conditions:a}}))}},{key:"handleAddCondition",value:function(){this.setState((function(t){return{conditions:[].concat(j()(t.conditions),[{ID:0,property:"",comparison_method:"",value:""}])}}))}},{key:"handleRemoveCondition",value:function(t){this.setState((function(e){return{conditions:e.conditions.filter((function(e,n){return n!==t}))}}))}},{key:"handleActionChange",value:function(t,e){this.setState((function(n){var o=j()(n.actions);return o[t]=A(A({},n.actions[t]),{},{action:e}),{actions:o}}))}},{key:"handleActionMetaChange",value:function(t,e,n){this.setState((function(o){var a=j()(o.actions);return a[t]=A(A({},o.actions[t]),{},{meta:A(A({},o.actions[t].meta),{},E()({},e,n))}),{actions:a}}))}},{key:"handleAddAction",value:function(){this.setState((function(t){return{actions:[].concat(j()(t.actions),[{ID:0,action:"create_task",triggered_count:0,last_triggered:"",meta:{}}])}}))}},{key:"handleRemoveAction",value:function(t){this.setState((function(e){return{actions:e.actions.filter((function(e,n){return n!==t}))}}))}},{key:"render",value:function(){var t=this;return Object(h.createElement)("div",{className:"ptc-completionist-automation-details-form"},Object(h.createElement)(D,{title:this.state.title,changeTitle:function(e){return t.handleAutomationChange("title",e)},description:this.state.description,changeDescription:function(e){return t.handleAutomationChange("description",e)}}),Object(h.createElement)(x,{hook_name:this.state.hook_name,changeEvent:function(e){return t.handleAutomationChange("hook_name",e)}}),Object(h.createElement)(R,{conditions:this.state.conditions,event:this.state.hook_name,changeCondition:this.handleConditionChange,addCondition:this.handleAddCondition,removeCondition:this.handleRemoveCondition}),Object(h.createElement)(P,{actions:this.state.actions,changeAction:this.handleActionChange,addAction:this.handleAddAction,removeAction:this.handleRemoveAction,changeActionMeta:this.handleActionMetaChange}),Object(h.createElement)("button",{onClick:function(){return console.log(t.state)}},this.state.saveButtonLabel))}}]),n}(w),D=function(t){l()(n,t);var e=C(n);function n(t){return a()(this,n),e.call(this,t)}return r()(n,[{key:"render",value:function(){var t=this;return Object(h.createElement)("div",{className:"automation-info"},Object(h.createElement)("input",{type:"text",value:this.props.title,onChange:function(e){return t.props.changeTitle(e.target.value)}}),Object(h.createElement)("textarea",{value:this.props.description,onChange:function(e){return t.props.changeDescription(e.target.value)}}))}}]),n}(w),x=function(t){l()(n,t);var e=C(n);function n(t){return a()(this,n),e.call(this,t)}return r()(n,[{key:"createSelectOptions",value:function(t){return Object.keys(t).map((function(e){return Object(h.createElement)("option",{value:e,key:e},t[e])}))}},{key:"render",value:function(){var t=this,e=this.createSelectOptions(window.ptc_completionist_automations.event_user_options),n=this.createSelectOptions(window.ptc_completionist_automations.event_post_options);return Object(h.createElement)("div",{className:"automation-event"},Object(h.createElement)("h2",null,Object(h.createElement)("span",{className:"automation-step-number"},"1")," Trigger Event"),Object(h.createElement)("select",{value:this.props.hook_name,onChange:function(e){return t.props.changeEvent(e.target.value)}},Object(h.createElement)("option",{value:""},"(Choose Event)"),Object(h.createElement)("optgroup",{label:"User Events"},e),Object(h.createElement)("optgroup",{label:"Post Events"},n)))}}]),n}(w),R=function(t){l()(n,t);var e=C(n);function n(t){var o;return a()(this,n),(o=e.call(this,t)).loadPropertyOptions=o.loadPropertyOptions.bind(s()(o)),o.loadComparisonMethodOptions=o.loadComparisonMethodOptions.bind(s()(o)),o.loadConditionFieldsets=o.loadConditionFieldsets.bind(s()(o)),o}return r()(n,[{key:"createSelectOptions",value:function(t){return Object.keys(t).map((function(e){return Object(h.createElement)("option",{value:e,key:e},t[e])}))}},{key:"loadPropertyOptions",value:function(){Object.keys(window.ptc_completionist_automations.event_user_options).includes(this.props.event)?this.propertyOptions=this.createSelectOptions(window.ptc_completionist_automations.field_user_options):Object.keys(window.ptc_completionist_automations.event_post_options).includes(this.props.event)?this.propertyOptions=this.createSelectOptions(window.ptc_completionist_automations.field_post_options):this.propertyOptions=Object(h.createElement)("option",null,"(Choose Event)")}},{key:"loadComparisonMethodOptions",value:function(){this.comparisonMethodOptions=window.ptc_completionist_automations.field_comparison_methods.map((function(t){return Object(h.createElement)("option",{value:t,key:t},t)}))}},{key:"loadConditionFieldsets",value:function(){var t=this;this.conditionFieldsets=this.props.conditions.map((function(e,n){var o=null;return"is empty"!==e.comparison_method&&"is filled"!==e.comparison_method&&(o=Object(h.createElement)("input",{type:"text",value:e.value,key:n,onChange:function(e){return t.props.changeCondition(n,"value",e.target.value)}})),Object(h.createElement)("fieldset",{className:"automation-condition",key:n},Object(h.createElement)("legend",null,"Condition"),Object(h.createElement)("select",{value:e.property,key:n,onChange:function(e){return t.props.changeCondition(n,"property",e.target.value)}},t.propertyOptions),Object(h.createElement)("select",{value:e.comparison_method,key:n,onChange:function(e){return t.props.changeCondition(n,"comparison_method",e.target.value)}},t.comparisonMethodOptions),o,Object(h.createElement)("button",{onClick:function(){return t.props.removeCondition(n)}},"Remove"))}))}},{key:"render",value:function(){return this.loadPropertyOptions(),this.loadComparisonMethodOptions(),this.loadConditionFieldsets(),Object(h.createElement)("div",{className:"automation-conditions-list"},Object(h.createElement)("h2",null,Object(h.createElement)("span",{className:"automation-step-number"},"2")," Conditions"),this.conditionFieldsets,Object(h.createElement)("button",{onClick:this.props.addCondition},"Add Condition"))}}]),n}(w),P=function(t){l()(n,t);var e=C(n);function n(t){var o;return a()(this,n),(o=e.call(this,t)).loadActionMetaInputs=o.loadActionMetaInputs.bind(s()(o)),o.loadActionFieldsets=o.loadActionFieldsets.bind(s()(o)),o}return r()(n,[{key:"createSelectOptions",value:function(t){return Object.keys(t).map((function(e){return Object(h.createElement)("option",{value:e,key:e},t[e])}))}},{key:"loadActionMetaInputs",value:function(t,e){var n=this;switch(t.action){case"create_task":return Object(h.createElement)("div",{className:"action-meta_create_task"},Object(h.createElement)("input",{id:"ptc-new-task_name_"+e,type:"text",placeholder:"Write a task name...",value:t.meta.name,onChange:function(t){return n.props.changeActionMeta(e,"name",t.target.value)}}),Object(h.createElement)("div",{class:"form-group"},Object(h.createElement)("label",{for:"ptc-new-task_task_author_"+e},"Creator"),Object(h.createElement)("select",{id:"ptc-new-task_task_author_"+e,value:t.meta.task_author,onChange:function(t){return n.props.changeActionMeta(e,"task_author",t.target.value)}},this.createSelectOptions(window.ptc_completionist_automations.workspace_users))),Object(h.createElement)("div",{class:"form-group"},Object(h.createElement)("label",{for:"ptc-new-task_assignee_"+e},"Assignee"),Object(h.createElement)("select",{id:"ptc-new-task_assignee_"+e,value:t.meta.assignee,onChange:function(t){return n.props.changeActionMeta(e,"assignee",t.target.value)}},Object(h.createElement)("option",{value:""},"None (Unassigned)"),this.createSelectOptions(window.ptc_completionist_automations.workspace_users))),Object(h.createElement)("div",{class:"form-group"},Object(h.createElement)("label",{for:"ptc-new-task_due_on_"+e},"Due Date"),Object(h.createElement)("input",{id:"ptc-new-task_due_on_"+e,type:"date",pattern:"\\d\\d\\d\\d-\\d\\d-\\d\\d",placeholder:"yyyy-mm-dd",value:t.meta.due_on,onChange:function(t){return n.props.changeActionMeta(e,"due_on",t.target.value)}})),Object(h.createElement)("div",{class:"form-group"},Object(h.createElement)("label",{for:"ptc-new-task_project_"+e},"Project"),Object(h.createElement)("select",{id:"ptc-new-task_project_"+e,value:t.meta.project,onChange:function(t){return n.props.changeActionMeta(e,"project",t.target.value)}},Object(h.createElement)("option",{value:""},"None (Private Task)"),this.createSelectOptions(window.ptc_completionist_automations.workspace_projects))),Object(h.createElement)("div",{class:"form-group"},Object(h.createElement)("label",{for:"ptc-new-task_notes_"+e},"Description"),Object(h.createElement)("textarea",{id:"ptc-new-task_notes_"+e,value:t.meta.notes,onChange:function(t){return n.props.changeActionMeta(e,"notes",t.target.value)}})),Object(h.createElement)("div",{class:"form-group"},Object(h.createElement)("label",{for:"ptc-new-task_project_"+e},"Pin"),Object(h.createElement)("select",{id:"ptc-new-task_project_"+e,value:t.meta.post_id,onChange:function(t){return n.props.changeActionMeta(e,"post_id",t.target.value)}},Object(h.createElement)("option",{value:""},"None (General Task)"))));default:return Object(h.createElement)("div",{className:"automation-meta-default"},Object(h.createElement)("p",null,Object(h.createElement)("em",null,"Choose an action to see additional options.")))}}},{key:"loadActionFieldsets",value:function(){var t=this,e=this.createSelectOptions(window.ptc_completionist_automations.action_options);this.actionFieldsets=this.props.actions.map((function(n,o){return Object(h.createElement)("fieldset",{className:"automation-action",key:o},Object(h.createElement)("legend",null,"Action"),Object(h.createElement)("select",{value:n.action,onChange:function(e){return t.props.changeAction(o,e.target.value)},key:o},e),t.loadActionMetaInputs(n,o),Object(h.createElement)("button",{onClick:function(){return t.props.removeAction(o)}},"Remove"))}))}},{key:"render",value:function(){return this.loadActionFieldsets(),Object(h.createElement)("div",{className:"automation-actions-list"},Object(h.createElement)("h2",null,Object(h.createElement)("span",{className:"automation-step-number"},"3")," Actions"),this.actionFieldsets,Object(h.createElement)("button",{onClick:this.props.addAction},"Add Action"))}}]),n}(w);function T(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=f()(t);if(e){var a=f()(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return m()(this,n)}}jQuery((function(t){try{var e=document.getElementById("ptc-completionist-automations-root");if(null!==e){var n=wp.element,o=n.render,i=function(t){l()(n,t);var e=T(n);function n(t){var o;return a()(this,n),(o=e.call(this,t)).state={automations:[{ID:123,title:"Sample Automation",description:"This automation does not actually exist in the database and is only for frontend testing purposes.",hook_name:"post_updated",last_modified:"2020/06/11 14:16",conditions:[{ID:124,property:"post_status",comparison_method:"equals",value:"publish"},{ID:126,property:"post_type",comparison_method:"equals",value:"post"}],actions:[{ID:125,action:"create_task",triggered_count:79,last_triggered:"2020/06/11 14:20",meta:{task_author:1,name:"Finish coding Automations frontend with ReactJS"}}]},{ID:223,title:"Donor Members Listing",description:"This automation does not actually exist in the database and is only for frontend testing purposes.",hook_name:"user_register",last_modified:"2020/06/11 14:16",conditions:[{ID:224,property:"first_name",comparison_method:"is filled",value:""},{ID:226,property:"last_name",comparison_method:"is filled",value:""}],actions:[{ID:225,action:"create_task",triggered_count:17,last_triggered:"2020/06/19 14:20",meta:{task_author:1,name:"Verify and add donor to members listing"}}]}]},o.goToAutomation=o.goToAutomation.bind(s()(o)),o}return r()(n,[{key:"goToAutomation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if("new"===t){var e=new URLSearchParams(location.search);e.set("automation",t),history.pushState({},"Completionist &ndash; Add New Automation","?"+e.toString())}else if(t<=0){var n=new URLSearchParams(location.search);n.delete("automation"),history.pushState({},"Completionist &ndash; Automation "+t,"?"+n.toString())}else{var o=new URLSearchParams(location.search);o.set("automation",t),history.pushState({automationId:t},"Completionist &ndash; Automation "+t,"?"+o.toString())}this.forceUpdate()}},{key:"componentDidMount",value:function(){window.addEventListener("popstate",this.goToAutomation)}},{key:"render",value:function(){var t=this,e=new URLSearchParams(location.search).get("automation");if("new"===e)return Object(h.createElement)("div",{className:"ptc-completionist-automation-create"},Object(h.createElement)("h1",null,"New Automation"),Object(h.createElement)(S,null),Object(h.createElement)("button",{onClick:function(){return t.goToAutomation()}},"Back"));var n=this.state.automations.findIndex((function(t){return t.ID==e}));return n>-1?Object(h.createElement)("div",{className:"ptc-completionist-automation-details"},Object(h.createElement)("h1",null,"Viewing automation ",e),Object(h.createElement)(S,{automation:this.state.automations[n]}),Object(h.createElement)("button",{onClick:function(){return t.goToAutomation()}},"Back")):Object(h.createElement)(g,{automations:this.state.automations,goToAutomation:this.goToAutomation})}}]),n}(n.Component);o(Object(h.createElement)(i,null),e)}}catch(t){console.error(t)}}))}]);